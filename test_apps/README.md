# Test Apps for sblite

This directory contains scripts for setting up and running official Supabase example applications with sblite as the backend.

## Directory Structure

```
test_apps/
├── README.md              # This file
├── scripts/               # Setup and startup scripts (in source control)
│   ├── common.sh          # Shared utilities
│   ├── setup-*.sh         # Setup scripts for each app
│   └── start-*.sh         # Startup scripts (generated by setup)
├── shoplite/              # ShopLite demo app (in source control)
└── <app-name>/            # Cloned apps (gitignored)
```

## Available Apps

### Todo List Examples

| App | Setup Script | Description |
|-----|-------------|-------------|
| Next.js Todo List | `setup-nextjs-todo.sh` | Simple todo app with RLS |
| SvelteJS Todo List | `setup-svelte-todo.sh` | Svelte version of todo app |

### User Management Examples

| App | Setup Script | Description |
|-----|-------------|-------------|
| Next.js User Management | `setup-nextjs-user-management.sh` | Profile management with avatars |
| React User Management | `setup-react-user-management.sh` | React + Vite version |
| Vue 3 User Management | `setup-vue3-user-management.sh` | Vue 3 Composition API |
| Svelte User Management | `setup-svelte-user-management.sh` | Svelte version |
| SvelteKit User Management | `setup-sveltekit-user-management.sh` | SvelteKit with SSR |

### Third-Party Apps

| App | Setup Script | Description |
|-----|-------------|-------------|
| [Atomic CRM](https://github.com/marmelab/atomic-crm) | `setup-atomic-crm.sh` | Full-featured CRM with contacts, companies, deals, tasks, and notes |
| [FinOpenPOS](https://github.com/JoaoHenriqueBarbosa/FinOpenPOS) | `setup-finopenpos.sh` | Open-source Point of Sale system with products, customers, orders, and transactions |

## Quick Start

### 1. Setup an App

```bash
# From the sblite root directory
./test_apps/scripts/setup-nextjs-todo.sh
```

This will:
- Clone the example from the Supabase repository
- Install npm dependencies
- Initialize the sblite database
- Create the required tables and RLS policies
- Generate a startup script

### 2. Start the App

```bash
./test_apps/scripts/start-nextjs-todo-list.sh
```

This will:
- Start sblite on http://localhost:8080
- Start the app's dev server
- Both services will be stopped when you press Ctrl+C

### 3. Open the App

Open the URL shown in the terminal (usually http://localhost:3000 or http://localhost:5173).

## Configuration

### Environment Variables

You can customize behavior with environment variables:

```bash
# Custom port for sblite
SBLITE_PORT=9000 ./test_apps/scripts/setup-nextjs-todo.sh

# Custom JWT secret
SBLITE_JWT_SECRET=my-secret ./test_apps/scripts/setup-nextjs-todo.sh
```

### Default Configuration

- **sblite URL**: http://localhost:8080
- **JWT Secret**: `super-secret-jwt-key-please-change-in-production`
- **Database**: `<app-dir>/data.db`

## Troubleshooting

### "sblite binary not found"

The setup script will automatically build sblite if needed. Make sure you have Go installed:

```bash
go version  # Should be 1.21+
```

### "Port already in use"

If port 8080 is in use, either stop the other service or use a different port:

```bash
SBLITE_PORT=9000 ./test_apps/scripts/start-nextjs-todo-list.sh
```

### "Database not found"

The setup script creates the database. If you deleted it, run the setup script again or manually initialize:

```bash
./sblite init --db test_apps/nextjs-todo-list/data.db
```

### App can't connect to sblite

Check that:
1. sblite is running (look for the "Starting sblite" message)
2. The `.env.local` or `.env` file has the correct URL and key
3. No firewall is blocking localhost connections

## Adding New Apps

To add a new test app:

1. Create a setup script in `scripts/`:
   ```bash
   cp scripts/setup-nextjs-todo.sh scripts/setup-my-app.sh
   ```

2. Modify the script:
   - Update `APP_NAME` and `APP_DIR`
   - Update the `clone_supabase_example` path
   - Add any required database schema
   - Update the env file creation if needed

3. Run the setup:
   ```bash
   ./test_apps/scripts/setup-my-app.sh
   ```

## Notes

- **Profile creation**: Unlike real Supabase, sblite doesn't support PostgreSQL triggers. User profiles won't be auto-created on signup; users need to create their profile manually.

- **Storage**: The user management examples use storage for avatars. Make sure sblite is running with storage enabled (default).

- **RLS**: Row Level Security is enforced by sblite using query rewriting. Policies are defined in the database.
